<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 620" style="background: white;">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#374151"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" font-family="system-ui, sans-serif" font-size="22" font-weight="bold" fill="#111827">GPT-2 MLP Block (Feed-Forward Network)</text>
  <text x="450" y="60" text-anchor="middle" font-family="system-ui, sans-serif" font-size="13" fill="#6b7280">Per-position transformation with 4× expansion bottleneck</text>

  <!-- Key insight box -->
  <rect x="100" y="80" width="700" height="45" rx="6" fill="#eff6ff" stroke="#3b82f6" stroke-width="1"/>
  <text x="450" y="100" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#1e40af">KEY INSIGHT: Linear layers only operate on LAST dimension (C=384)</text>
  <text x="450" y="117" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#3b82f6">T=256 positions are processed independently in parallel (same weights broadcast across all positions)</text>

  <!-- Input -->
  <rect x="70" y="180" width="120" height="80" rx="10" fill="#e0e7ff" stroke="#6366f1" stroke-width="2"/>
  <text x="130" y="210" text-anchor="middle" font-family="system-ui, sans-serif" font-size="15" font-weight="600" fill="#312e81">Input</text>
  <text x="130" y="230" text-anchor="middle" font-family="monospace" font-size="11" fill="#4338ca">(32, 256, 384)</text>
  <text x="130" y="248" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#6366f1">(B, T, C)</text>

  <!-- Arrow 1 -->
  <line x1="190" y1="220" x2="235" y2="220" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- c_fc (expansion) -->
  <rect x="240" y="155" width="150" height="130" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
  <text x="315" y="180" text-anchor="middle" font-family="system-ui, sans-serif" font-size="16" font-weight="600" fill="#92400e">c_fc</text>
  <text x="315" y="200" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" fill="#b45309">nn.Linear</text>
  <text x="315" y="220" text-anchor="middle" font-family="monospace" font-size="12" fill="#d97706">384 → 1536</text>
  <text x="315" y="240" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#78716c">(4× expansion)</text>
  <text x="315" y="258" text-anchor="middle" font-family="monospace" font-size="10" fill="#92400e">→ (32, 256, 1536)</text>
  <text x="315" y="275" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#78716c">more neurons to detect features</text>

  <!-- Arrow 2 -->
  <line x1="390" y1="220" x2="435" y2="220" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- GELU -->
  <rect x="440" y="175" width="110" height="90" rx="10" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
  <text x="495" y="205" text-anchor="middle" font-family="system-ui, sans-serif" font-size="16" font-weight="600" fill="#065f46">GELU</text>
  <text x="495" y="225" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#047857">tanh approx</text>
  <text x="495" y="245" text-anchor="middle" font-family="monospace" font-size="10" fill="#059669">(32, 256, 1536)</text>
  <text x="495" y="258" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#78716c">non-linear activation</text>

  <!-- Arrow 3 -->
  <line x1="550" y1="220" x2="595" y2="220" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- c_proj (contraction) -->
  <rect x="600" y="155" width="150" height="130" rx="10" fill="#fce7f3" stroke="#ec4899" stroke-width="2"/>
  <text x="675" y="180" text-anchor="middle" font-family="system-ui, sans-serif" font-size="16" font-weight="600" fill="#9d174d">c_proj</text>
  <text x="675" y="200" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" fill="#be185d">nn.Linear</text>
  <text x="675" y="220" text-anchor="middle" font-family="monospace" font-size="12" fill="#db2777">1536 → 384</text>
  <text x="675" y="240" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#78716c">(projection back)</text>
  <text x="675" y="258" text-anchor="middle" font-family="monospace" font-size="10" fill="#9d174d">→ (32, 256, 384)</text>
  <text x="675" y="275" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#78716c">compress/summarize</text>

  <!-- Output arrow and label -->
  <line x1="750" y1="220" x2="790" y2="220" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="805" y="210" text-anchor="start" font-family="system-ui, sans-serif" font-size="11" fill="#374151">→ (+)</text>
  <text x="805" y="225" text-anchor="start" font-family="system-ui, sans-serif" font-size="10" fill="#6b7280">residual</text>
  <text x="805" y="238" text-anchor="start" font-family="system-ui, sans-serif" font-size="10" fill="#6b7280">add</text>

  <!-- Dimension flow visualization -->
  <rect x="100" y="320" width="700" height="85" rx="8" fill="#f9fafb" stroke="#e5e7eb" stroke-width="1"/>
  <text x="450" y="345" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="600" fill="#374151">Dimension Flow (C only — B and T stay constant)</text>

  <!-- Flow boxes -->
  <rect x="130" y="360" width="70" height="28" rx="4" fill="#e0e7ff" stroke="#6366f1" stroke-width="1"/>
  <text x="165" y="379" text-anchor="middle" font-family="monospace" font-size="13" fill="#4338ca">384</text>

  <text x="220" y="379" text-anchor="middle" font-family="system-ui, sans-serif" font-size="16" fill="#374151">→</text>

  <rect x="240" y="360" width="100" height="28" rx="4" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
  <text x="290" y="379" text-anchor="middle" font-family="monospace" font-size="13" fill="#b45309">1536</text>

  <text x="360" y="379" text-anchor="middle" font-family="system-ui, sans-serif" font-size="16" fill="#374151">→</text>

  <rect x="380" y="360" width="100" height="28" rx="4" fill="#d1fae5" stroke="#10b981" stroke-width="1"/>
  <text x="430" y="379" text-anchor="middle" font-family="monospace" font-size="13" fill="#059669">1536</text>

  <text x="500" y="379" text-anchor="middle" font-family="system-ui, sans-serif" font-size="16" fill="#374151">→</text>

  <rect x="520" y="360" width="70" height="28" rx="4" fill="#fce7f3" stroke="#ec4899" stroke-width="1"/>
  <text x="555" y="379" text-anchor="middle" font-family="monospace" font-size="13" fill="#be185d">384</text>

  <text x="620" y="372" text-anchor="start" font-family="system-ui, sans-serif" font-size="11" fill="#6b7280">→ back to</text>
  <text x="620" y="388" text-anchor="start" font-family="system-ui, sans-serif" font-size="11" fill="#6b7280">residual stream</text>

  <!-- Why section -->
  <rect x="100" y="420" width="700" height="95" rx="8" fill="#fefce8" stroke="#eab308" stroke-width="1"/>
  <text x="450" y="445" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="600" fill="#a16207">Why Expand → Contract?</text>
  <text x="120" y="468" text-anchor="start" font-family="system-ui, sans-serif" font-size="11" fill="#78350f">1. MORE CAPACITY: 4× more hidden units = more patterns can be detected</text>
  <text x="120" y="485" text-anchor="start" font-family="system-ui, sans-serif" font-size="11" fill="#78350f">2. NON-LINEAR MIXING: GELU between linear layers enables complex feature combinations</text>
  <text x="120" y="502" text-anchor="start" font-family="system-ui, sans-serif" font-size="11" fill="#78350f">3. BOTTLENECK: Force network to compress learnings back to 384 dims (summarize)</text>

  <!-- Legend -->
  <rect x="170" y="555" width="16" height="16" rx="3" fill="#fef3c7" stroke="#f59e0b" stroke-width="1.5"/>
  <text x="195" y="568" font-family="system-ui, sans-serif" font-size="12" fill="#6b7280">Expand</text>

  <rect x="300" y="555" width="16" height="16" rx="3" fill="#d1fae5" stroke="#10b981" stroke-width="1.5"/>
  <text x="325" y="568" font-family="system-ui, sans-serif" font-size="12" fill="#6b7280">Activation</text>

  <rect x="440" y="555" width="16" height="16" rx="3" fill="#fce7f3" stroke="#ec4899" stroke-width="1.5"/>
  <text x="465" y="568" font-family="system-ui, sans-serif" font-size="12" fill="#6b7280">Contract</text>

  <text x="590" y="568" font-family="system-ui, sans-serif" font-size="11" font-style="italic" fill="#9ca3af">No T×T interaction here — positions independent</text>

</svg>